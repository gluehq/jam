
@import 'base';


//  M I X I N S

@mixin clearfix {
  *zoom: 1;
  &:before,
  &:after {
    display: table;
    content: '';
    line-height: 0;
  }
  &:after {
    clear: both;
  }
}


//  B A S E

body {
    margin: 0;
}

.jam-jar {

    position: relative;
    margin: 0 auto;
    width: 100%;
    max-width: $large - 1px;
    min-width: 320px;

    * {
        box-sizing: border-box;
    }

    //  Make images fit their cols
    img {
        width: 100%;
        max-width: none;
    }

}

[class*=jam-span-] {

    position: relative;
    margin: 0 auto;

    &.align-l {
        margin: 0;
    }

    &.align-r {
        margin: 0 0 0 auto;
    }

    //  Remove bottom margins from last paragraphs etc
    *:last-child {
        margin-bottom: 0;// Causes issue, but elements like uniform columns require this
    }

}

[class*=jam-cols-] {

    display: flex;
    flex-wrap: wrap;
    position: relative;

    // Non grid element default positioning
    * {
        position: relative;
        // Do not remove margin as multiple text element blocks will require it
        width: 100%;
    }

}

// Set common vars
$cols-min: nth($cols, 1);
$cols-max: nth($cols, -1);

@mixin span($span, $span-actual, $span-to, $media) {

    // Collapse handheld span widths if $span and $span-to are different

    $span-selects: '';

    @for $span-this from $span through $span-to {

        @if $media == phone-plus {

            @if $span-this != $span-to {

                // Build up the string of selectors to collapse before continuing

                $span-selects: $span-selects + '.jam-span-#{$span-this}, ';

            } @else {

                // Maximise phone span widths and transfer inset to columns

                #{$span-selects}.jam-span-#{$span-this} {

                    width: percentage($span-actual/$span-max);

                    &[class*=jam-cols] > div, [class*=jam-cols] > div {
                        width: 100%;
                    }

                    &[class*=jam-cols] > .jam-bleed {

                        margin: 0 percentage((($span-max - $span-actual) / 2)/$span-actual) * -1;
                        width: percentage(($span-actual + ($span-max - $span-actual))/$span-actual);

                    }

                }

            }

        } @else {

            .jam-span-#{$span-this} {

                width: percentage($span-this/$span-max);

                @for $sub-width from $span-this through $span-min {

                    .jam-span-#{$sub-width} {
                        width: percentage($sub-width/$span-this);
                    }

                }

            }

        }

    }

}

// Return which span a span will collapse to
// Amount of spans that collapse together set with $span-collapse

@function span-collapse($span) {
    $span-remain: ($span-max - $span) / 2;
    $span-mod: ceil($span-remain / $span-collapse);
    $span-collapse: $span-max - ($span-mod * 2);
    @return $span-collapse;
}

// Determine how to build spans

@mixin check-span($media) {

    $span-collapse-last: $span-max;
    
    @for $span from $span-max through $span-min {

        @if $media == large {
        
            @include span($span, $span, $span, $media);

        }
        
        @if $media == phone-plus {
            
            @if $span < $span-collapse-last {

                @for $sub-span from $span through $span-min {

                    @if span-collapse($sub-span) == span-collapse($span) {
                        $span-collapse-last: $sub-span;
                    }

                }

                @include span($span, span-collapse($span), $span-collapse-last, $media);

            }
            
        }
        
    }
    
}

/* Spans */

@include check-span(large);

/* Uniform column widths */

@each $col in $cols {

    .jam-cols-#{$col} > div {
        width: percentage(1/$col);
    }

}

/* Gaps */

@mixin gaps($media) {

    // Default gutter padding WARNING: Change at peril
    [class*=jam-span-] {

        *:not(div) {
            padding: 0 xgap($media, 0.5);
        }

        div:not([class*=jam-cols-]) {
            // padding: ygap($media, 0.5) 0 ygap($media, 1) 0;
        }

        @if $media == large {

            > div[class*=jam-span-] {
                // padding-bottom: ygap($media, 0.5);
            }

        }

    }

}

@include gaps(large);

// Likely to be content divs WARNING: Change at peril
[class*=jam-cols-] [class*=jam-span-] {

    // Remove the top padding to align with content in an adjacent column 
    > div:first-child {
        // padding-top: 0;
    }

}

/* Flip */

.jam-flip {
    flex-direction: row-reverse;
}

/* Media query loop */

@each $media in $all-media {
    
    @include media($media) {

        @if $media != large {
            @include check-span($media);
        }

        // Avoid double-ups
        @if $media != large and $media != phone-plus {
            @include gaps($media);
        }

        @if $media == phone-plus {

            // Removing gaps around full-bleed images on phone
            [class*=jam-cols] > .jam-bleed {

                *, div {
                    padding: 0;
                }

            }

        }

    }

}
